## Структура проекта

### 1. Prefabs:

1. DroneAuthoring - Сущность дрона (внутри есть скрытая сущность OreInDroneAuthoring)
2. HomeAuthoring - Сущность базы
3. OreAuthoring - Сущность руды (ресурса)
4. OreInDroneAuthoring - Сущность добытой руды в дроне
5. PrefabsAuthoring - Сущность хранения префабов всех сущностей

### 2. Scripts:

1. DroneMiningOreSystem - Система добычи руды
2. DroneMoveDisableSystem - Система приоритета дронов доставляющих руду на базу, над дронами летящими к руде
3. DroneOreSelectSystem - Система выбора руды незанятой другими дронами команды
4. DroneRotationSystem - Система поворота (в данным момент стабилизации вращения) дрона
5. DroneSpawnSystem - Система спавна дронов при старте симуляции
6. DroneToHomeSystem - Система возвращения дрона с рудой на базу
7. DroneToOreReorderSystem - Система сброса цели дрона (ранее выбранной в DroneOreSelectSystem), если её ранее добыл дрон другой команды
8. DroneTrailSystem - Система отрисовки машрута дронов до выбранной руды (работает только в редакторе, т.к. является отладочной функцией)
9. OreReloadSystem - Система респавна руды
10. UISystem - Система обработки UI-ввода пользователя

### 3. UI Toolkit

1. NewUXMLTemplate - Основаная страница UI
2. Styles - Таблица стилей
3. UI - Компонент инициализации и хранения элементов UI для доступа к ним из UISystem

## Логика работы

### 1. Инициализация UI

Сначала запускается Start() внутри UI.cs и сораняет в своих полях всех ссылки на используемые в UI элементы (кнопку, слайдеры, лейблы и чекбокс)
После создаёт сущность с компонентом UILoaded, что свидетельствует о завершении инициализации UI

### 2. Запуск симуляции

UISystem дождавшись наличия UILoaded начинает обработку ввода пользователя. При клике по кнопке публичное поле Clicked в UI.cs становится true, что указывает UISystem о нажатии кнопки 
Так был сделано потому, что UISystem должна обновляется внутри своего контекста, нельзя например создать сущность по вызову Action из Button

После этого обнуляются счётчики доставленных руд на обоих базах и удаляются все ранее созданные дроны и руды.
Затем создаются два запроса на спавн руд и дронов. Их обрабатывают отдельные соответствующие системы

### 3. Спавн руды и дронов

Система OreSpawnSystem получив запрос OreSpawnRequest начинает спавн руды и по завершению удаляет компонент запроса и добавляет компонент OreSpawnEnded

Система DroneSpawnSystem дождавшись компонента OreSpawnEnded начинает спавн дронов в своответствии с настройками их количества и скорости из DroneRestartData.

По завершению спавна дронов для обоих баз сущность с компонентом DroneRestartData удаляется

### 4. Выбор целей (руд) для дронов

Система DroneOreSelectSystem распределяет доступные руды между дронами каждой команды. 
Учитываются только занятость руда своей командой, поэтому дроны разных команд могу следовать к одной руде, и заберёт её тот, кто завершит добычу первым

В случае, когда два дрона их разных команд следовали к добычи одной и той же руды, но одинн из их добыл её первым, 
у другого дрона проиходит сброс цели в системе DroneToOreReorderSystem и он становится доступным для выбора новой руды в системе DroneOreSelectSystem

### 5. Полёт дронов к руде

Дроны для которых есть актуальная цель следуют к ней в системе DroneToOreSystem.
Для предотвращения столкновения дронов возвращающих добытую руду с дроонами летящими за рудой,
поток пустых дронов лятящих к руде летит над землёй на высоте 5.

При подлёте к руде дрон снижается и подлёте вплотную к руде в дрону и руде добавляются компоненты DroneMining и OreMining соответственно.
Так же для фильтрации в системе DroneOreSelectSystem для руды добавляется компонент OreToTeamLeft или OreToTeamRight, в зависимости от команды дрона, которая её добывает

### 6. Добыча руды

Дроны с компонентом DroneMining запускают таймер продолжительностью 2 секунды, после чего для Ore удаляется OreMining и добавляется OreReload,
который обрабатывается в системе OreReloadSystem. Внутри неё для руды добавляется DisableRendering, скрывая её
Для дрона же у его части с сущностью OreInDrone удаляется компонент DisableRendering, делая её видимой. 

Таким образом создаётся эффект перемещения добытой руды из земли на дрон

### 7. Перезагрузка руды

В системе OreReloadSystem запускается таймер при старте которого для Ore добавляеся DisableRendering, а после завершения удаляется вместе с OreReload,
делая руду снова доступной для добычи для обоих команд

### 8. Возращение руды на базу

В системе DroneToHomeSystem дроны в которых есть руда следуют к центру своей базы (для предотвращения столкновений с пустыми дронами, дроны с рудой едут по земле).
При приближении вплотную к базе у дрона удаляется DroneToHome а также скрывается OreInDrone путём добавления DisableRendering к нему, 
что создаёт эффект выгрузки руды из дрона на базу.

Это увеличивает OresDelivered внутри Home команды дрона, доставившего руду, что отражается в Label LeftTeam и RightTeam в UI в системе UISystem

После этого дрон становится свободным и попадает в обработку в системе DroneOreSelectSystem

### 9. Система приоритета

При подлёте к базе на краткосрочном промежутке возникают ситуации, когда пути пустого дрона и дрона с рудой пересекаются. 
Чтобы дрон мог без проблем выгрузить руду, для него включается приоритеи движения над ближайшими дронами без руды.
Для них отключается движения, путём добавления DroneMoveDisable в системе DroneMoveDisableSystem, 
что отключает возможность их форсированного движения в системе DroneToOreSystem, что в свою очередь даёт возможность дрону с DroneToHome безпрепятственно выгрузить руду в центре базы

### 10. Поворот дроны

В данный момент дрон не имеет отличий в своих сторонах, потому нет необходимости выравнивать его рыскание (ось Y) например по направлению движения.
Требуется только невилировать тангаж (ось X) и ролл (ось Z). Для этого в системе DroneRotationSystem для дронов указывается вращение quaternion.identity
